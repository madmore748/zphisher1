var absa=window.absa||{};absa.resetPin=absa.resetPin||{};absa.apps.unAuthSessionID={};absa.resetPin.OnPasswordBlockKeyUp=function(a){if(a.id=="pff1"){if(a.value.length){document.getElementById("pff2").focus()}}else{if(a.id=="pff2"){if(a.value.length){document.getElementById("pff3").focus()}}}};absa.resetPin.onUserDetailsSubmit=function(e){var f=bb.selector.queryAncestor(e,".ap-resetPin-form1");var b=bb.selector.queryAncestor(e,".ap-resetPin-container");var a=bb.selector.query(f,".ui-captchaCheck");var d=bb.selector.query(f,".ap-resetPin-messageInvalidCaptcha");var c=bb.selector.query(f,".ap-resetPin-formFoot");phe.common.hide(d);if(absa.form.validate(f)){phe.captchaCheck.testCaptcha(f,function(k){var o=JSONRequest.parse(k.text);if(o.success){absa.NONCE="111e222w333e444r555t666";var l=phe.textBox.getValue(bb.selector.query(f,".ap-resetPin-accNo"));var p=phe.textBox.getValue(bb.selector.query(f,".ap-resetPin-userNo"));absa.apps.unAuthSessionID=document.body.getAttribute("sId");var h="resetPin/webservice/SecurityWebService/forgotPin?sId="+absa.apps.unAuthSessionID+"&accNo="+l+"&userNo="+p;var m=window.location.href;var i=m.indexOf("lang=af");if(i!="-1"){h=h+"&tmpLang=af"}var j=bb.selector.query(document,".ap-resetPin-showMeHow");phe.common.hide(j);phe.loadingMessage.showLoadingMessage(b);absa.io.makeRequest(h,function(n){if(!n.errors.length){var t=bb.html.createElementFromString(n.text);var s=bb.selector.query(t,".ap-resetPin-errorMessage");if(s){absa.resetPin.onErrorhandling(false,f,t)}else{var r=bb.selector.query(t,".ap-resetPin-container");phe.common.setAttribute(r,"proxyurl",h);b.parentNode.replaceChild(t,b);absa.initializeNewContent(t);absa.resetPin.setPasswordFocus()}}else{phe.form.displayIOErrorMessage(f,true)}phe.loadingMessage.hideLoadingMessage(b)})}else{oErrorContainer=bb.selector.query(f,".genericMessage-place-holder");var q=bb.selector.query(f,".ui-captchaCheck");var g=bb.selector.query(a,".ui-captchaCheck--iconRefresh");phe.common.show(d);absa.jcaptcha.refreshChallenge(g)}})}};absa.resetPin.onBeforeValidatePasswordSubmit=function(g){var e;var a=bb.selector.queryAll(g,".ap-resetPin-p");var f=bb.selector.queryAll(g,".ap-resetPin-pName");var h=bb.selector.queryAll(g,".ap-resetPin-posHidden");for(var c=0;c<3;c++){var e=phe.textBox.getValue(bb.selector.query(g,".ap-resetPin-pff"+(c+1)));var b=phe.textBox.getAttribute(bb.selector.query(g,".ap-resetPin-pff"+(c+1)),"name");var d=phe.textBox.getAttribute(bb.selector.query(g,".ap-resetPin-pff"+(c+1)),"data-pos");phe.hiddenField.setValue(a[c],e);phe.hiddenField.setValue(f[c],b);phe.hiddenField.setValue(h[c],d)}};absa.resetPin.setPasswordFocus=function(){var a=document.getElementById("pff1");if(a){a.focus()}};absa.resetPin.onFormATMDetailsSubmit=function(f){var g=bb.selector.queryAncestor(f,".ap-resetPin-formATMDetails");var a=g.getAttribute("context");var e=g.getAttribute("proxy");var d=bb.selector.query(g,".ap-resetPin-atmPinNumber");var c=phe.textBox.getValue(d);var b=document.body.getAttribute("sId");phe.textBox.setAttribute(d,"required","true");if(absa.form.validate.checkElement(d)){phe.loadingMessage.showLoadingMessage(g);absa.xd.makeXDRequest(a,e,"/resetPin/j_pin_block_cache","PIN="+c+"&sId="+b,absa.resetPin.validateEncipherResponse1)}else{absa.form.validateAndSubmit(g)}};absa.resetPin.validateEncipherResponse1=function(a,d){var e=bb.selector.query(document.body,".ap-resetPin-formATMDetails");if(a.success){var b=bb.selector.query(e,".ap-resetPin-correlationId");b.value=a.correlationId;var c=bb.selector.query(e,".ap-resetPin-atmPinNumber");phe.textBox.setAttribute(c,"required","");phe.textBox.setValue(c,"");phe.loadingMessage.hideLoadingMessage(e);absa.form.validateAndSubmit(e)}else{}};absa.resetPin.onFormNewPinSubmit=function(f){var g=bb.selector.queryAncestor(f,".ap-resetPin-FormNewPin");var e=bb.selector.query(g,".ap-resetPin-AOLPin");var b=bb.selector.query(g,".ap-resetPin-AOLPinConfirm");var c=phe.textBox.getValue(e);var a=g.getAttribute("context");var d=g.getAttribute("proxy");phe.textBox.setAttribute(e,"required","true");phe.textBox.setAttribute(b,"required","true");if((absa.form.validate.checkElement(e))&&(absa.form.validate.checkElement(b))){phe.loadingMessage.showLoadingMessage(g);absa.xd.makeXDRequest(a,d,"/resetPin/j_pin_block_cache","PIN="+c,absa.resetPin.validateEncipherResponse2)}else{absa.form.validateAndSubmit(g)}};absa.resetPin.validateEncipherResponse2=function(b,e){var f=bb.selector.query(document.body,".ap-resetPin-FormNewPin");if(b.success){var c=bb.selector.query(f,".ap-resetPin-correlationId");c.value=b.correlationId;var d=bb.selector.query(f,".ap-resetPin-AOLPin");var a=bb.selector.query(f,".ap-resetPin-AOLPinConfirm");phe.textBox.setAttribute(d,"required","");phe.textBox.setAttribute(a,"required","");phe.textBox.setValue(d,"");phe.textBox.setValue(a,"");phe.loadingMessage.hideLoadingMessage(f);absa.form.validateAndSubmit(f)}else{}};absa.resetPin.onErrorhandling=function(i,j,e){var c=bb.selector.query(document,".ap-resetPin-Wizard");var h;if(!i){h=bb.selector.query(e,".ap-resetPin-errorMessage")}else{var k=phe.wizard.getCurrentStepBody(c);h=bb.selector.query(k,".ap-resetPin-errorMessage")}if(h){var f;if(!i){f=bb.selector.query(j,".ui-formFoot")}else{phe.wizard.selectStepRelative(c,-1);k=phe.wizard.getCurrentStepBody(c);f=bb.selector.query(k,".ui-formFoot")}var g=bb.selector.query(f,".ap-resetPin-errorMessage");if(g){g.parentNode.removeChild(g)}f.insertBefore(h,f.firstChild)}var d=document.getElementById("pff1");if(d){var b=document.getElementById("pff2");var a=document.getElementById("pff3");phe.textBox.setValue(d,"");phe.textBox.setValue(b,"");phe.textBox.setValue(a,"");d.focus()}};absa.resetPin.checkOnlyNumbers=function(e){var d=/[0-9]/;var c=true;var b;for(b=0;b<phe.textBox.getValue(e).length;b++){if(!(phe.textBox.getValue(e).charAt(b).match(d))){c=false;break}}if(c==false){return false}else{return true}};absa.resetPin.onAOLPinChange=function(a){var c=phe.textBox.getValue(a).length;var b=absa.resetPin.checkOnlyNumbers(a);if(c<4||b==false){phe.textBox.setAttribute(a,"customValidation")}else{phe.textBox.setAttribute(a,"customValidation","")}};absa.resetPin.onAOLConfirmPinChange=function(a){var e=bb.selector.queryAncestor(a,".ap-resetPin-FormNewPin");var c=phe.textBox.getValue(a).length;var b=absa.resetPin.checkOnlyNumbers(a);if(c<4||b==false){phe.textBox.setAttribute(a,"customValidation")}else{phe.textBox.setAttribute(a,"customValidation","");var d=bb.selector.query(e,".ap-resetPin-AOLPin");if(phe.textBox.getValue(d)!=phe.textBox.getValue(a)){phe.textBox.setAttribute(a,"customValidation")}}};