absa.form.wizardBridge=absa.form.wizardBridge||{};absa.form.wizardBridge.handleResponseIIP=function(d,e,f,b){var a=/ui-form--TVNForm/.test(e.text);if(a){var c=bb.selector.queryAncestor(d,".ap-paySingle");if(c==null){c=bb.selector.queryAncestor(d,".ap-payMultiple-root")}phe.loadingMessage.hideLoadingMessage(c)}absa.form.wizardBridge.handleResponse(d,e,f,b)};absa.form.wizardBridge.handleResponse=function(t,o,p,j,w){var f=false;var v=bb.selector.queryAncestor(t,".ui-wizard");var l=bb.selector.query(v,".ui-wizard-body-wrapper");var q=bb.selector.query(l,".ap-registration-inRegProcess");if(q){f=true}var h=!/class=["']+validationErrors["']+/.test(o.text);if(h){var v=bb.selector.queryAncestor(t,".ui-wizard");var b;if(w!=true){b=phe.wizard.getNextStepBody(v)}else{b=phe.wizard.getCurrentStepBody(v)}phe.wizard.setShowMeHow(b);phe.wizard.setCallMeButton(b);phe.wizard.setAdvisorButton(b);var g=bb.selector.query(v,".ui-wizard--showMeHow");absa.showMeHow.switchOff(g);if(b){b.innerHTML=o.text;absa.initializeNewContent(b)}if(w!=true){phe.wizard.selectStep(b)}var k=bb.selector.queryAll(b,".ui-slider");if(k){if(k.length){for(var y=0;y<k.length;y++){phe.slider.initializeBehavior(k[y])}}}var z=bb.selector.query(b,".ap-TVM-form");if(z){var q=bb.selector.query(l,".ap-registration-inRegProcess");if(q){absa.n2fa.updateFormStatusSVM(z,false,false,true)}else{gadgets.pubsub.publish("TVM-form-loaded",z)}var m=bb.selector.query(b,".ui-form--TVNForm-code");if(m&&m.offsetHeight>0){if(bb.browser.ie){setTimeout(function(){m.focus()},10)}else{m.focus()}}}var u=/ui-form--TVNForm/.test(o.text);if(f&&u){var n=bb.selector.query(b,".ui-form--TVNForm");phe.common.setAttribute(n,"action","webservice/AccessControlWebService/validateTransactionVerificationCode?registration=true&sId="+absa.apps.unAuthSessionID)}var x=bb.selector.queryAll(v,".ui-wizard-body");var B=x[x.length-1];var E=bb.selector.query(b,"form");if(!(bb.html.hasClass(B,"ui-wizard-body-selected"))&&t._changed&&E){E._changed=true}if(p){try{if(b!=null){p.call(b,b)}else{p.call(t,t)}}catch(A){bb.command.trace(null,"Error when calling success method:"+A.message||A)}}if(absa.VI=="true"){if((bb.html.hasClass(B,"ui-wizard-body-selected"))){var a=bb.selector.query(b,".validation-place-holder");var D=bb.selector.query(a,".ui-message");if(D){D.focus()}}}}else{var C=bb.html.createElementFromString(o.text);var d=bb.selector.query(C,".validationErrors");var v=bb.selector.queryAncestor(t,".ui-wizard");var s=bb.selector.queryAll(v,".ui-wizard-head");var r=phe.wizard.getAttribute(v,"validationKickBackStep");if(r&&r=="-1"){phe.wizard.selectStepRelative(v.firstChild,parseInt("0"))}else{if(r){phe.wizard.selectStepAbsolute(v,parseInt(r))}else{if(s.length>2){if((s.length-3)>(phe.wizard.getCurrentStepIndex(v)+1)){phe.wizard.selectStepAbsolute(v,phe.wizard.getCurrentStepIndex(v))}else{phe.wizard.selectStepAbsolute(v,s.length-3)}}else{phe.wizard.selectStepAbsolute(v,0)}}}var c=bb.selector.query(v,".ui-wizard-body-selected");absa.form.showValidationErrors(c,d);try{if(j){j.call(t,t)}}catch(A){bb.command.trace(null,"Error when calling error method:"+A.message||A)}}};absa.form.wizardBridge.openRVNForm=function(d,e,g,a){var c=bb.selector.queryAncestor(d,".ui-wizard");var f=d.parentNode;f.style.display="none";var b=bb.html.createElementFromString(e.text);f.parentNode.appendChild(b);absa.form.attachHandlers(b)};absa.form.wizardBridge.cancelRVNForm=function(c){var e=bb.selector.queryAncestor(c,"form");if(e){e.reset();if(e._trackUnconfirmedChanges){e._changed=false}}var a=bb.selector.queryAncestor(c,".ui-modal");if(a){phe.modal.hideModal()}else{var d=bb.selector.queryAncestor(c,".p-gadget");var b=bb.getControllerFromView(d);if(b){b.minimize();d.focus()}}};absa.form.wizardBridge.resendRVNForm=function(g,h,a){var f=absa.CONTEXT+"/proxy?pipe=genericWebservice&ws=AccessControlWebService&action=resendTransactionVerification&referenceNumber="+encodeURIComponent(h)+"&go&sId="+a;var b=bb.selector.queryAncestor(g,".ui-form--RVNForm");var e=bb.selector.query(b,".ui-formFoot");var d=bb.selector.query(e,".RVNCodeError");if(d){try{e.removeChild(d)}catch(c){}}phe.loadingMessage.showLoadingMessage(b);absa.io.makeRequest(f,function(m){phe.loadingMessage.hideLoadingMessage(b);if(!m.errors.length){var p=bb.html.createElementFromString(m.text);var k=bb.selector.query(p,".ui-message-error");if(k){e.insertBefore(p,e.firstChild)}else{var j=bb.selector.query(b,".ui-textBox");b.reset();var n=bb.selector.query(b,".ap-sendRVN-timestamp");if(n){n.innerHTML=p.getAttribute("data-timeStamp")||p.getAttribute("data-timestamp")}}phe.form.displayIOErrorMessage(b,false);var l=phe.common.getAttribute(p,"data-errorKey");if((l!=null)&&(l.toLowerCase().indexOf("resendsexceed")>-1)){var o=bb.selector.query(b,".ap-button-extra");phe.common.hide(o);var i=bb.selector.query(b,".ap-button-next");phe.common.hide(i)}}else{phe.form.displayIOErrorMessage(b,true)}})};absa.form.wizardBridge.handleRVN=function(k,e,f,g,h){var l=!/RVNCodeError/.test(e.text);if(l){var b;if(h){b=bb.selector.queryAncestor(k,".ap-forceLoadNode")}var m=bb.selector.queryAncestor(k,"[proxyurl]");var d=bb.selector.queryAncestor(k,".ui-tabBody");var a=bb.selector.queryAncestor(k,".ui-tableBodyRowExpandableExtension");var j=bb.selector.queryAncestor(k,".ui-modalBody[proxyurl]");var c=bb.selector.queryAncestor(k,".ap-gadget-lazyContent");if(b){absa.lazyLoadNode(b,true)}else{if(a&&a.getAttribute("dataFileView")){var i=bb.selector.queryAncestor(k,".ui-form");if(i==null){i=bb.selector.query(k,".ui-form")}if(i!=null){phe.form.setAttribute(i,"trackUnconfirmedChanges","false");i._trackUnconfirmedChanges=false;i._changed=false}phe.tableBodyRow.expandRow(a.previousSibling,phe.tableBodyRowExpandableExtention.getAttribute(a,"dataFileView"),false)}else{if(m){absa.lazyLoadNode(m,true)}else{if(d){phe.tabBody.reload(d)}else{if(j){absa.lazyLoadNode(j,true)}else{if(c){absa.lazyLoadNode(c,true)}}}}}}}else{absa.form.wizardBridge.updateDisplayForErrorsFound(k,e)}};absa.form.wizardBridge.cancelTVNForm=function(b){var a=bb.selector.queryAncestor(b,".ui-wizard");phe.wizard.selectStepAbsolute(a,0);absa.form.wizardBridge.removeTVNStep(b)};absa.form.wizardBridge.resendTVNForm=function(f,b){var h=bb.selector.queryAncestor(f,".ui-form--TVNForm");var c=bb.selector.query(h,".ap-sendTVN-referenceNumber");var g=phe.hiddenField.getValue(c);var e=bb.selector.query(h,".ui-formFoot");var a=bb.selector.query(e,".TVNCodeError");var d=absa.CONTEXT+"/proxy?pipe=genericWebservice&ws=AccessControlWebService&action=resendTransactionVerification&referenceNumber="+encodeURIComponent(g);if(b=="registerForAOLStep2"){d="webservice/AccessControlWebService/resendTransactionVerification?registration=true&referenceNumber="+encodeURIComponent(g)+"&sId="+absa.apps.unAuthSessionID}if(a){e.removeChild(a)}phe.loadingMessage.showLoadingMessage(h);absa.io.makeRequest(d,function(m){phe.loadingMessage.hideLoadingMessage(h);if(!m.errors.length){var p=bb.html.createElementFromString(m.text);var k=bb.selector.query(p,".ui-message-error");if(k){e.insertBefore(p,e.firstChild)}else{var j=bb.selector.query(h,".ui-textBox");h.reset();var n=bb.selector.query(h,".ap-sendTVN-timestamp");if(n){n.innerHTML=p.getAttribute("data-timeStamp")||p.getAttribute("data-timestamp")}}phe.form.displayIOErrorMessage(h,false);var l=phe.common.getAttribute(p,"data-errorKey");if((l!=null)&&(l.toLowerCase().indexOf("resendsexceed")>-1)){var o=bb.selector.query(h,".ap-button-extra");phe.common.hide(o);var i=bb.selector.query(h,".ap-button-next");phe.common.hide(i)}}else{phe.form.displayIOErrorMessage(h,true)}})};absa.form.wizardBridge.handleOTP=function(l,j,k,f,o){if(typeof k=="undefined"){k=null}if(typeof f=="undefined"){f=null}if(typeof o=="undefined"){o=false}var e=!/SureCheck2CodeError/.test(j.text);if(e){var q;if(o){q=bb.selector.queryAncestor(l,".ap-forceLoadNode")}var i=bb.selector.queryAncestor(l,"[proxyurl]");var a=bb.selector.queryAncestor(l,".ui-tabBody");var r=bb.selector.queryAncestor(l,".ui-tableBodyRowExpandableExtension");var p=bb.selector.queryAncestor(l,".ui-modalBody[proxyurl]");var h=bb.selector.queryAncestor(l,".ap-gadget-lazyContent");var d=bb.selector.queryAncestor(l,".ap-container-content-USSD-login");var c=l.getAttribute("data-mimic");if(c==null){c="RVN"}if(c=="TVN"){var m=bb.selector.queryAncestor(l,".ui-wizard");if(m){var g=bb.selector.query(m,".ui-wizard-body-selected");if(g){var b=g.previousSibling;if(b){var n=bb.selector.query(b,"form");if(n){phe.wizard.selectStep(b);bb.html.fireEvent(n,"submit",true,true)}}}}}else{if(q){absa.lazyLoadNode(q,true)}else{if(r&&r.getAttribute("dataFileView")){var n=bb.selector.queryAncestor(l,".ui-form");if(n==null){n=bb.selector.query(l,".ui-form")}if(n!=null){phe.form.setAttribute(n,"trackUnconfirmedChanges","false");n._trackUnconfirmedChanges=false;n._changed=false}phe.tableBodyRow.expandRow(r.previousSibling,phe.tableBodyRowExpandableExtention.getAttribute(r,"dataFileView"),false)}else{if(i){absa.lazyLoadNode(i,true)}else{if(a){phe.tabBody.reload(a)}else{if(p){absa.lazyLoadNode(p,true)}else{if(h){absa.lazyLoadNode(h,true)}else{if(d){doLoadNewPasswordAfterUSSD()}}}}}}}}}else{absa.form.wizardBridge.updateDisplayForErrorsFound(l,j)}};absa.form.wizardBridge.handleTVN=function(j,b,d,e){if(typeof d=="undefined"){d=null}if(typeof e=="undefined"){e=null}var k=!/TVNCodeError/.test(b.text);if(k&&b.status=="200"){var a=bb.selector.queryAncestor(j,".ui-wizard");if(a){var h=bb.selector.query(a,".ui-wizard-body-selected");if(h){var f=h.previousSibling;if(f){var g=bb.selector.query(f,"form");var i=bb.selector.query(j,"input[name=referenceNumber]");if(g){if(i){var c=i.cloneNode(true);g.appendChild(c)}phe.wizard.selectStep(f);bb.html.fireEvent(g,"submit",true,true)}}}}}else{absa.form.wizardBridge.updateDisplayForErrorsFound(j,b)}};absa.form.wizardBridge.updateDisplayForErrorsFound=function(k,a){var f=bb.html.createElementFromString(a.text);var d=bb.selector.query(k,".SureCheck2CodeError");var j=bb.selector.query(k,".ap-button-next");var h=bb.selector.query(k,".ap-button-extra");var i=bb.selector.query(k,".ui-formFoot");var g=bb.selector.query(k,".ui-formFoot-backup");var b=(i)?i:g;phe.form.displayIOErrorMessage(k,false);var c=phe.common.getAttribute(f,"data-errorCode");if(c==null){c="-"}var e=phe.common.getAttribute(f,"data-errorKey");if(e==null){e="-"}if(c.toLowerCase().indexOf("otp")>-1&e.toLowerCase().indexOf("retriesexceed")>-1){if(j){phe.common.hide(j)}}else{if(((c.toLowerCase().indexOf("rvn")>-1)|(c.toLowerCase().indexOf("tvn")>-1))&e.toLowerCase().indexOf("retriesexceed")>-1){if(h){phe.common.hide(h)}if(j){phe.common.hide(j)}}}if(d!=null){b.removeChild(d)}b.insertBefore(f,b.firstChild)};absa.form.wizardBridge.removeTVNStep=function(d){var b=bb.selector.queryAncestor(d,".ui-wizard");if(b){var a=bb.selector.query(b,".ui-wizard-body--TVN");var c=bb.selector.query(b,".ui-wizard-head--TVN");if(c){c.parentNode.removeChild(c)}if(a){a.parentNode.removeChild(a)}}};